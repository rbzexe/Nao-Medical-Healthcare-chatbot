<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Healthcare Translation App</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --sky-blue: #87CEEB;
      --sky-pink: #FFB6C1;
      --sky-green: #98FB98;
      --light-blue: #E6F2FF;
      --light-pink: #FFECF0;
      --light-green: #F0FFF0;
    }
    
    body {
      background: linear-gradient(135deg, var(--sky-blue) 0%, var(--sky-pink) 50%, var(--sky-green) 100%);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Bubble animation */
    .bubbles {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
      top: 0;
      left: 0;
      pointer-events: none;
    }
    
    .bubble {
      position: absolute;
      bottom: -100px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      opacity: 0.5;
      animation: rise 15s infinite ease-in;
    }
    
    @keyframes rise {
      0% {
        bottom: -100px;
        transform: translateX(0) scale(0.5);
      }
      50% {
        transform: translate(100px, -500px) scale(1.2);
      }
      100% {
        bottom: 1080px;
        transform: translateX(-200px) scale(0.8);
      }
    }
    
    /* Create multiple bubbles with different properties */
    .bubble:nth-child(1) {
      width: 40px;
      height: 40px;
      left: 10%;
      animation-duration: 12s;
      animation-delay: 0s;
    }
    
    .bubble:nth-child(2) {
      width: 20px;
      height: 20px;
      left: 20%;
      animation-duration: 16s;
      animation-delay: 1s;
    }
    
    .bubble:nth-child(3) {
      width: 50px;
      height: 50px;
      left: 35%;
      animation-duration: 14s;
      animation-delay: 2s;
    }
    
    .bubble:nth-child(4) {
      width: 30px;
      height: 30px;
      left: 50%;
      animation-duration: 18s;
      animation-delay: 0s;
    }
    
    .bubble:nth-child(5) {
      width: 35px;
      height: 35px;
      left: 70%;
      animation-duration: 15s;
      animation-delay: 3s;
    }
    
    .bubble:nth-child(6) {
      width: 45px;
      height: 45px;
      left: 80%;
      animation-duration: 13s;
      animation-delay: 2s;
    }
    
    .bubble:nth-child(7) {
      width: 25px;
      height: 25px;
      left: 65%;
      animation-duration: 17s;
      animation-delay: 1s;
    }
    
    .bubble:nth-child(8) {
      width: 60px;
      height: 60px;
      left: 25%;
      animation-duration: 19s;
      animation-delay: 4s;
    }
    
    /* Pulse animation for mic */
    .pulse { 
      animation: pulse 1.5s infinite ease-in-out; 
    }
    
    @keyframes pulse { 
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.3); opacity: 0.7; } 
    }
    
    /* Wave animation for sound bars */
    .bar { 
      width: 4px; 
      height: 10px; 
      margin: 0 2px; 
      background: #dc2626; 
      display: inline-block; 
      border-radius: 2px; 
      animation: wave 1.2s infinite ease-in-out;
    }
    
    .bar:nth-child(1) { animation-delay: 0s; } 
    .bar:nth-child(2) { animation-delay: 0.2s; } 
    .bar:nth-child(3) { animation-delay: 0.4s; } 
    .bar:nth-child(4) { animation-delay: 0.6s; } 
    .bar:nth-child(5) { animation-delay: 0.8s; }
    
    @keyframes wave { 
      0%, 100% { height: 8px; } 
      50% { height: 20px; } 
    }
    
    /* Glassmorphism effect */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      transition: all 0.3s ease;
    }
    
    .glass:hover {
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.25);
      transform: translateY(-2px);
    }
    
    /* Content container */
    .content-container {
      position: relative;
      z-index: 1;
    }
    
    /* Button styles */
    .btn-primary {
      background: linear-gradient(to right, #4facfe 0%, #00f2fe 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      background: linear-gradient(to right, #00f2fe 0%, #4facfe 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    
    .btn-secondary {
      background: linear-gradient(to right, #ff9a9e 0%, #fad0c4 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      background: linear-gradient(to right, #fad0c4 0%, #ff9a9e 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    
    .btn-success {
      background: linear-gradient(to right, #43e97b 0%, #38f9d7 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .btn-success:hover {
      background: linear-gradient(to right, #38f9d7 0%, #43e97b 100%);
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
    
    /* Page transition */
    .page {
      display: none;
      animation: fadeIn 0.8s ease forwards;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .active {
      display: block;
    }
    
    /* Text animation */
    .fade-in {
      animation: fadeInText 0.8s ease forwards;
    }
    
    @keyframes fadeInText {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Custom select styles */
    select {
      background: rgba(255, 255, 255, 0.8);
      transition: all 0.3s ease;
    }
    
    select:hover {
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.3);
    }
    
    /* Transcript styles */
    .transcript-box {
      transition: all 0.5s ease;
      min-height: 100px;
    }
    
    .message {
      padding: 10px 15px;
      border-radius: 18px;
      margin-bottom: 12px;
      max-width: 90%;
      animation: messageAppear 0.5s ease forwards;
      opacity: 0;
      transform: translateY(10px);
    }
    
    @keyframes messageAppear {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .original-message {
      background: var(--light-blue);
      border-bottom-left-radius: 4px;
      align-self: flex-start;
      text-align: left;
    }
    
    .translated-message {
      background: var(--light-green);
      border-bottom-right-radius: 4px;
      align-self: flex-end;
      text-align: right;
      margin-left: auto;
    }
    
    /* Status animation */
    #status {
      transition: all 0.5s ease;
    }
    
    /* Floating animation */
    .floating {
      animation: floating 3s ease-in-out infinite;
    }
    
    @keyframes floating {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    /* Navbar styles */
    .nav-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .nav-pill {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50px;
      padding: 5px;
      display: inline-flex;
      backdrop-filter: blur(10px);
    }
    
    .nav-item {
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .nav-item.active {
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Bubble background -->
  <div class="bubbles">
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
  </div>

  <!-- Navbar -->
  <nav class="glass shadow-md sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <h1 class="text-xl font-bold text-blue-600 flex items-center">
        <i class="fas fa-heartbeat mr-2 text-red-500"></i> Nao Medical
      </h1>
    </div>
  </nav>

  <!-- Navigation Pills -->
  <div class="nav-container mt-6">
    <div class="nav-pill">
      <div class="nav-item active" data-page="home">Home</div>
      <div class="nav-item" data-page="about">About</div>
      <div class="nav-item" data-page="contact">Contact</div>
    </div>
  </div>

  <!-- Home Page -->
  <main id="home-page" class="page active content-container flex-1 max-w-6xl mx-auto w-full px-4 py-8">
    <header class="mb-8 flex items-center justify-between flex-wrap gap-4">
      <div class="glass rounded-2xl p-6 floating">
        <h2 class="text-3xl font-bold text-blue-600">Healthcare Translation <i class="fas fa-language ml-2"></i></h2>
        <p class="text-gray-700 mt-2">Demo: Voice â†’ Transcript â†’ Translate â†’ Speak</p>
      </div>
      <!-- Mic indicator -->
      <div id="micIndicator" class="hidden items-center gap-3 text-red-600 glass rounded-2xl p-4">
        <div class="w-4 h-4 bg-red-600 rounded-full pulse"></div>
        <span class="text-sm font-medium">Recording...</span>
        <div class="flex items-end h-6">
          <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
        </div>
      </div>
    </header>

    <!-- Controls -->
    <div class="flex flex-wrap items-center gap-4 mb-8 glass rounded-2xl p-6">
      <label class="flex flex-col text-sm flex-1 min-w-[160px]">
        <span class="font-medium mb-1 text-gray-700"><i class="fas fa-microphone mr-1"></i> From Language</span>
        <select id="sourceLang" class="rounded-xl border-0 px-4 py-3 mt-1 shadow-sm">
          <option value="en-US">ğŸ‡ºğŸ‡¸ English</option>
          <option value="hi-IN">ğŸ‡®ğŸ‡³ Hindi</option>
          <option value="es-ES">ğŸ‡ªğŸ‡¸ Spanish</option>
          <option value="fr-FR">ğŸ‡«ğŸ‡· French</option>
          <option value="zh-CN">ğŸ‡¨ğŸ‡³ Chinese</option>
          <option value="ar-SA">ğŸ‡¸ğŸ‡¦ Arabic</option>
        </select>
      </label>

      <label class="flex flex-col text-sm flex-1 min-w-[160px]">
        <span class="font-medium mb-1 text-gray-700"><i class="fas fa-globe mr-1"></i> To Language</span>
        <select id="targetLang" class="rounded-xl border-0 px-4 py-3 mt-1 shadow-sm">
          <option value="hi">ğŸ‡®ğŸ‡³ Hindi</option>
          <option value="en" selected>ğŸ‡ºğŸ‡¸ English</option>
          <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
          <option value="fr">ğŸ‡«ğŸ‡· French</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ Chinese</option>
          <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
        </select>
      </label>

      <div class="flex flex-wrap gap-3 mt-4 w-full justify-center">
        <button id="startBtn" class="btn-primary px-5 py-3 rounded-xl font-medium">
          <i class="fas fa-play-circle mr-2"></i> Start
        </button>
        <button id="stopBtn" class="btn-secondary px-5 py-3 rounded-xl font-medium">
          <i class="fas fa-stop-circle mr-2"></i> Stop
        </button>
        <button id="clearBtn" class="btn-secondary px-5 py-3 rounded-xl font-medium">
          <i class="fas fa-broom mr-2"></i> Clear
        </button>
        <button id="speakBtn" class="btn-success px-5 py-3 rounded-xl font-medium">
          <i class="fas fa-volume-up mr-2"></i> Speak
        </button>
      </div>
    </div>

    <!-- Panels -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="glass rounded-2xl p-6 transcript-box flex flex-col">
        <h3 class="font-semibold mb-4 text-blue-600 text-lg">
          <i class="fas fa-comment-dots mr-2"></i> Original Transcript
        </h3>
        <div id="originalText" class="space-y-3 flex-1 overflow-y-auto"></div>
      </div>
      <div class="glass rounded-2xl p-6 transcript-box flex flex-col">
        <h3 class="font-semibold mb-4 text-green-600 text-lg">
          <i class="fas fa-comments mr-2"></i> Translated Transcript
        </h3>
        <div id="translatedText" class="space-y-3 flex-1 overflow-y-auto"></div>
      </div>
    </div>

    <!-- Status -->
    <p id="status" class="text-sm text-gray-700 glass rounded-2xl p-4 text-center">
      <i class="fas fa-info-circle mr-2"></i> Status: idle
    </p>
  </main>

  <!-- About Page -->
  <main id="about-page" class="page content-container flex-1 max-w-4xl mx-auto w-full px-4 py-8">
    <div class="glass rounded-2xl p-8">
      <h2 class="text-3xl font-bold text-blue-600 mb-6">
        <i class="fas fa-info-circle mr-3"></i> About This Project
      </h2>
      <div class="space-y-5 text-gray-700">
        <p class="text-lg">This healthcare translation application is designed to bridge the communication gap between patients and healthcare providers who speak different languages. <i class="fas fa-hand-holding-medical ml-1"></i></p>
        
        <p>In medical situations, clear communication can be a matter of life and death. This tool helps eliminate language barriers by providing real-time speech translation, allowing doctors to understand symptoms and concerns, and enabling patients to comprehend diagnoses and treatment plans. <i class="fas fa-stethoscope ml-1"></i></p>
        
        <p>Our mission is to make healthcare accessible to everyone, regardless of language differences, ensuring that all patients receive the care they need and deserve. <i class="fas fa-heart ml-1"></i></p>
        
        <div class="bg-blue-50 p-5 rounded-2xl border-l-4 border-blue-500 mt-6">
          <p class="font-medium text-blue-800 text-lg">
            <i class="fas fa-lightbulb mr-2"></i> This application was created by Rohit Bisht as a solution to healthcare communication barriers.
          </p>
          <p class="text-sm mt-3">
            <i class="fas fa-rocket mr-2"></i> The goal is to improve patient outcomes through better understanding between medical professionals and patients from diverse linguistic backgrounds.
          </p>
        </div>
      </div>
    </div>
  </main>

  <!-- Contact Page -->
  <main id="contact-page" class="page content-container flex-1 max-w-4xl mx-auto w-full px-4 py-8">
    <div class="glass rounded-2xl p-8">
      <h2 class="text-3xl font-bold text-blue-600 mb-6">
        <i class="fas fa-envelope mr-3"></i> Contact Us
      </h2>
      <div class="space-y-5 text-gray-700">
        <div class="bg-pink-50 p-5 rounded-2xl border-l-4 border-pink-500">
          <p class="font-medium text-pink-800 text-lg">
            <i class="fas fa-exclamation-circle mr-2"></i> This is a Nao Medical prototype application.
          </p>
          <p class="mt-3">
            <i class="fas fa-hard-hat mr-2"></i> The contact functionality is still in development. We're working hard to create the best possible experience for healthcare translation.
          </p>
        </div>
        
        <p>
          <i class="fas fa-clock mr-2"></i> Please check back soon for updates. For immediate needs, you can reach out to us at:
        </p>
        
        <div class="bg-green-50 p-5 rounded-2xl">
          <p class="font-semibold text-green-800">
            <i class="fas fa-envelope mr-2"></i> Email: contact@naomedical.com
          </p>
          <p class="font-semibold text-green-800 mt-3">
            <i class="fas fa-globe mr-2"></i> Website: www.naomedical.com
          </p>
        </div>
        
        <p>
          <i class="fas fa-thumbs-up mr-2"></i> We appreciate your interest in our healthcare translation solution and look forward to sharing the completed version with you soon.
        </p>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="glass border-t py-6 mt-8 content-container">
    <div class="max-w-6xl mx-auto px-4 text-center text-sm text-gray-700">
      <p>Â© 2025 Nao Medical. Prototype for pre-interview assignment. <i class="fas fa-code ml-1"></i></p>
      <p class="mt-2">
        <i class="fas fa-exclamation-triangle mr-1"></i> Works best in Chrome/Edge over <strong>https</strong> or <strong>localhost</strong>.
      </p>
    </div>
  </footer>

<script>
// Page navigation
function navigateToPage(pageId) {
  document.querySelectorAll('.page').forEach(page => {
    page.classList.remove('active');
  });
  document.getElementById(pageId + '-page').classList.add('active');
  
  // Update active link
  document.querySelectorAll('.page-link').forEach(link => {
    link.classList.remove('active');
  });
  document.querySelectorAll('.nav-item').forEach(item => {
    item.classList.remove('active');
  });
  
  document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
  document.querySelector(`.nav-item[data-page="${pageId}"]`).classList.add('active');
}

document.querySelectorAll('.page-link').forEach(link => {
  link.addEventListener('click', (e) => {
    e.preventDefault();
    const pageId = e.target.getAttribute('data-page');
    navigateToPage(pageId);
  });
});

document.querySelectorAll('.nav-item').forEach(item => {
  item.addEventListener('click', (e) => {
    const pageId = e.target.getAttribute('data-page');
    navigateToPage(pageId);
  });
});

// App functionality
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const clearBtn = document.getElementById('clearBtn');
const speakBtn = document.getElementById('speakBtn');
const originalTextDiv = document.getElementById('originalText');
const translatedTextDiv = document.getElementById('translatedText');
const statusDiv = document.getElementById('status');
const srcSelect = document.getElementById('sourceLang');
const tgtSelect = document.getElementById('targetLang');
const micIndicator = document.getElementById('micIndicator');

let recognition = null;
let isRecording = false;
let lastTranslatedSegment = '';

function updateStatus(t){ 
  statusDiv.innerHTML = `<i class="fas fa-info-circle mr-2"></i> Status: ${t}`;
  statusDiv.classList.add('fade-in');
  setTimeout(() => statusDiv.classList.remove('fade-in'), 500);
}

function showMic(show){ 
  micIndicator.classList.toggle("hidden", !show); 
  if (show) {
    micIndicator.classList.add('fade-in');
  }
}

function parseSrc(val){ 
  const [speechLang, translateCode] = val.split('|'); 
  return { speechLang, translateCode }; 
}

function parseTgt(val){ 
  const [translateCode, ttsLang] = val.split('|'); 
  return { translateCode, ttsLang }; 
}

// Add emoji based on text content
function addEmoji(text) {
  const healthTerms = [
    {term: 'pain', emoji: 'ğŸ˜«'},
    {term: 'hurt', emoji: 'ğŸ˜£'},
    {term: 'doctor', emoji: 'ğŸ‘¨â€âš•ï¸'},
    {term: 'nurse', emoji: 'ğŸ‘©â€âš•ï¸'},
    {term: 'hospital', emoji: 'ğŸ¥'},
    {term: 'medicine', emoji: 'ğŸ’Š'},
    {term: 'headache', emoji: 'ğŸ¤•'},
    {term: 'stomach', emoji: 'ğŸ¤¢'},
    {term: 'better', emoji: 'ğŸ™‚'},
    {term: 'thank', emoji: 'ğŸ™'},
    {term: 'hello', emoji: 'ğŸ‘‹'},
    {term: 'emergency', emoji: 'ğŸš‘'},
    {term: 'help', emoji: 'ğŸ†˜'},
    {term: 'heart', emoji: 'â¤ï¸'},
    {term: 'cough', emoji: 'ğŸ˜·'},
    {term: 'cold', emoji: 'ğŸ¥¶'},
    {term: 'fever', emoji: 'ğŸ¤’'},
    {term: 'allergy', emoji: 'ğŸ¤§'},
  ];
  
  let emojiToAdd = '';
  const lowerText = text.toLowerCase();
  
  for (const {term, emoji} of healthTerms) {
    if (lowerText.includes(term)) {
      emojiToAdd = emoji;
      break;
    }
  }
  
  // Default emoji if no specific term found
  if (!emojiToAdd) {
    const textLength = text.length;
    if (textLength < 10) emojiToAdd = 'ğŸ’¬';
    else if (textLength < 20) emojiToAdd = 'ğŸ—£ï¸';
    else emojiToAdd = 'ğŸ“';
  }
  
  return emojiToAdd + ' ' + text;
}

if (!('SpeechRecognition' in window) && !('webkitSpeechRecognition' in window)) {
  updateStatus('âŒ SpeechRecognition not supported in this browser.');
  startBtn.disabled = true;
}

startBtn.addEventListener('click', startRecognition);
stopBtn.addEventListener('click', stopRecognition);
clearBtn.addEventListener('click', () => {
  originalTextDiv.innerHTML = '';
  translatedTextDiv.innerHTML = '';
  lastTranslatedSegment = '';
});
speakBtn.addEventListener('click', () => {
  if (lastTranslatedSegment) speakText(lastTranslatedSegment);
  else speakText(translatedTextDiv.innerText || '');
});

function startRecognition(){
  if (isRecording) return;
  const srcLang = srcSelect.value;
  const SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRec();
  recognition.lang = srcLang;
  recognition.interimResults = true;
  recognition.continuous = true;

  recognition.onstart = () => { 
    isRecording = true; 
    updateStatus('ğŸ¤ Recording...'); 
    startBtn.disabled = true; 
    showMic(true); 
  };
  recognition.onerror = (e) => { updateStatus('âš ï¸ Error: ' + e.error); };
  recognition.onend = () => { 
    isRecording = false; 
    updateStatus('Idle'); 
    startBtn.disabled = false; 
    showMic(false); 
  };

  recognition.onresult = async (event) => {
    let interim = '';
    let final = '';
    for (let i = event.resultIndex; i < event.results.length; i++){
      const res = event.results[i];
      if (res.isFinal) final += res[0].transcript;
      else interim += res[0].transcript;
    }

    if (interim){
      const prev = originalTextDiv.querySelector('.interim');
      if (prev) {
        prev.textContent = interim;
      } else {
        const d = document.createElement('div'); 
        d.className = 'interim text-gray-500 italic message original-message'; 
        d.textContent = interim;
        originalTextDiv.appendChild(d);
      }
      originalTextDiv.scrollTop = originalTextDiv.scrollHeight;
    }

    if (final){
      const prevInterim = originalTextDiv.querySelector('.interim');
      if (prevInterim) prevInterim.remove();

      const last = originalTextDiv.lastElementChild;
      const emojiText = addEmoji(final);
      
      if (last && last.classList.contains("final-segment")) {
        last.textContent = emojiText;
      } else {
        const d = document.createElement('div'); 
        d.className = 'final-segment message original-message'; 
        d.textContent = emojiText;
        originalTextDiv.appendChild(d);
      }
      originalTextDiv.scrollTop = originalTextDiv.scrollHeight;

      const tgtLang = tgtSelect.value;
      try {
        updateStatus('ğŸ¤– Translating...');
        let translated = await translateWithGemini(final, tgtLang);
        const translatedWithEmoji = addEmoji(translated);

        const lastT = translatedTextDiv.lastElementChild;
        if (lastT && lastT.classList.contains("final-segment")) {
          lastT.textContent = translatedWithEmoji;
        } else {
          const td = document.createElement('div');
          td.className = 'final-segment message translated-message';
          td.textContent = translatedWithEmoji;
          translatedTextDiv.appendChild(td);
        }

        translatedTextDiv.scrollTop = translatedTextDiv.scrollHeight;
        lastTranslatedSegment = translated;
      } catch (err) {
        const td = document.createElement('div'); 
        td.className = 'message translated-message';
        td.textContent = 'âŒ [translation failed]';
        translatedTextDiv.appendChild(td);
      } finally {
        updateStatus('ğŸ¤ Recording...');
      }
    }
  };

  recognition.start();
}

function stopRecognition(){ if (recognition) recognition.stop(); }

/* -----------------------
   Translation (Gemini only)
   ----------------------- */
async function translateWithGemini(text, targetLang){
  const res = await fetch(
    "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=AIzaSyCxmhqAgBF3CKRK8n2zqQQrRFwOcOqvKPY",
    {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{
          parts: [{
            text: `Translate this into ${targetLang}: ${text}`
          }]
        }]
      })
    }
  );
  const data = await res.json();
  return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "[Gemini error]";
}

/* -----------------------
   Text-to-Speech
   ----------------------- */
function speakText(text){
  // Get the appropriate TTS language based on the target language
  const tgtLang = tgtSelect.value;
  let ttsLang = 'en-US'; // Default
  
  // Map language codes to TTS languages
  const langMap = {
    'hi': 'hi-IN',
    'en': 'en-US',
    'es': 'es-ES',
    'fr': 'fr-FR',
    'zh': 'zh-CN',
    'ar': 'ar-SA'
  };
  
  ttsLang = langMap[tgtLang] || 'en-US';
  
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = ttsLang;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
  updateStatus('ğŸ”Š Speaking...');
}

// Generate bubbles dynamically
function generateBubbles() {
  const bubblesContainer = document.querySelector('.bubbles');
  for (let i = 0; i < 15; i++) {
    const bubble = document.createElement('div');
    bubble.classList.add('bubble');
    
    // Random properties for variety
    const size = Math.random() * 40 + 10;
    bubble.style.width = `${size}px`;
    bubble.style.height = `${size}px`;
    bubble.style.left = `${Math.random() * 100}%`;
    bubble.style.animationDuration = `${Math.random() * 10 + 10}s`;
    bubble.style.animationDelay = `${Math.random() * 5}s`;
    
    bubblesContainer.appendChild(bubble);
  }
}

// Initialize bubbles
generateBubbles();
</script>
</body>
</html>